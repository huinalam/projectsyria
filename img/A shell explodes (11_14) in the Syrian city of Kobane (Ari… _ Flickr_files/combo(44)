YUI.add("hermes-template-photo-sidebar-actions",function(e,t){var n=e.Template.Handlebars.revive({1:function(e,t,n,r,i){var s;return e.escapeExpression((n.formatNumber||t&&t.formatNumber||n.helperMissing).call(t!=null?t:{},(s=t!=null?t.photo:t)!=null?s.commentCount:s,{name:"formatNumber",hash:{},data:i}))},3:function(e,t,n,r,i){var s;return e.escapeExpression((n.friendlyNumber||t&&t.friendlyNumber||n.helperMissing).call(t!=null?t:{},(s=t!=null?t.photo:t)!=null?s.commentCount:s,{name:"friendlyNumber",hash:{},data:i}))},compiler:[7,">= 4.0.0"],main:function(e,t,n,r,i){var s,o=t!=null?t:{},u=n.helperMissing,a=e.escapeExpression;return a((n.outlet||t&&t.outlet||u).call(o,t!=null?t["fave-view"]:t,{name:"outlet",hash:{},data:i}))+'\n<div>\n	<a title="Comment" class="button comment" href="#">\n		<span class="ui-icon-comments">&nbsp;</span>\n		<span class="button-comment-count">'+((s=n["if"].call(o,t!=null?t.realFullscreen:t,{name:"if",hash:{},fn:e.program(1,i,0),inverse:e.program(3,i,0),data:i}))!=null?s:"")+"</span>\n	</a>\n</div>\n"+a((n.outlet||t&&t.outlet||u).call(o,t!=null?t["share-view"]:t,{name:"outlet",hash:{},data:i}))},useData:!0}),r={};e.Array.each([],function(t){var n=e.Template.get("hermes/"+t);n&&(r[t]=n)}),e.Template.register("hermes/photo-sidebar-actions",function(t,i){return i=i||{},i.partials=i.partials?e.merge(r,i.partials):r,n(t,i)})},"@VERSION@",{requires:["template-base","handlebars-base"]});
YUI.add("photo-sidebar-actions-view",function(e){e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,subviewConfig:{"fave-view":{requiredToShowOnClient:!1,requiredToShowOnServer:!1},"fluid-share-photo-view":{requiredToShowOnClient:!0,requiredToShowOnServer:!0}},initializer:function(e){return this.photoId=e.photoId,this.get("container").get("innerHTML")===""&&this.setContainerHTML(""),this.realFullscreen=!!e.realFullscreen,this.isFullscreen=this.appContext.experiments.fullscreen.getMode(),this.signinPendingQueue=e.signinPendingQueue,this},loadState:function(){var t=this;return e.Promise.all([t.appContext.getModel("photo-engagement-models",t.photoId),t.appContext.getModel("photo-models",t.photoId)]).then(function(e){t.set("photo-engagement",e[0]),t.set("photo",e[1])})},buildContainer:function(){var e=this.get("photo-engagement");return this.setContainerWithTemplate("photo-sidebar-actions",{photo:e.toJSON(),realFullscreen:this.realFullscreen,"is-fullscreen":this.isFullscreen,"share-view":this.subviews["fluid-share-photo-view"]?this.subviews["fluid-share-photo-view"].get("container"):""}),this},commentClicked:function(t){function s(){e.SigninHelper.addPendingComment({id:n.photoId})}var n=this;if(t.ctrlKey)return;var r,i;t.preventDefault(),t.stopPropagation(),this.appContext.experiments.fullscreen.getMode()&&this.appContext.getViewer().signedIn?(setTimeout(function(){e.fire("flickr:photo-sidebar-actions-focus-comment-form")},1500),this.appContext.flapp.navigate(e.config.doc.location.href.replace("/lightbox",""))):this.appContext.getViewer().signedIn?(i=this.get("container").ancestor(".photo-sidebar-view").one(".comments-view textarea"),i&&i.focus()):(r=new e.Views.FluidModal({title:this.intlMessage({intlName:"common.OOPS"}),actionButtonLabel:this.intlMessage({intlName:"common.SIGN_IN"}),cancelButtonLabel:this.intlMessage({intlName:"photo-sidebar-actions-view.CANCEL"}),htmlMessage:this.intlMessage({intlName:"photo-sidebar-actions-view.SIGN_IN_TO_COMMENT"}),appContext:this.appContext,classList:"scrappy-dialog",dismissOnOverlayClick:!1,dismissOnActionClick:!0,actionButtonDisabled:!1,showCancelButton:!0,hideModalOverlay:!1,showCancelX:!0}),r.on("actionClick",function(e){s()}),r.show()),e.rapidTracker.beacon(this.name,"commentActionBarButtonClick")},menuItemsOpened:function(t){this.realFullscreen&&this.appContext.experiments.fullscreen.getMode()&&(t.preventDefault(),t.stopPropagation(),e.fire("flickr:photo-sidebar-fullscreen-expand"),t.keyCode===65?setTimeout(function(){e.fire("flickr:photo-page-open-add-gallery",t)},500):t.keyCode===69?setTimeout(function(){e.fire("flickr:photo-page-open-add-set",t)},500):t.keyCode===71?setTimeout(function(){e.fire("flickr:photo-page-open-add-group",t)},500):t.keyCode===84&&setTimeout(function(){e.fire("flickr:photo-page-open-add-tag",t)},500))},moreClicked:function(t){t.preventDefault(),t.stopPropagation(),e.rapidTracker.beacon(this.name,"detailedViewActionBarButtonClick")},downloadClicked:function(t){t.preventDefault(),t.stopPropagation(),e.rapidTracker.beacon(this.name,"downloadActionBarButtonClick")},infoClicked:function(t){t.preventDefault(),t.stopPropagation(),e.rapidTracker.beacon(this.name,"infoActionBarButtonClick")},activate:function(){var t=this.get("container"),n,r=this;return t&&(t.one(".comment")&&this.registerEventHandler(t.one(".comment").on("click",this.commentClicked,this)),e.on("flickr:photo-sidebar-actions-focus-comment-form",function(){r.get("container").ancestor(".photo-sidebar-view")?n=r.get("container").ancestor(".photo-sidebar-view").one(".comments-view textarea"):(n=e.one(".sub-photo-comments-view textarea"),n&&n.scrollIntoView()),n&&n.focus()}),this.appContext.experiments.fullscreen.getMode()&&(t.one(".more")&&this.registerEventHandler(t.one(".more").on("click",this.moreClicked,this)),t.one(".download")&&this.registerEventHandler(t.one(".download").on("click",this.downloadClicked,this)),t.one(".info")&&this.registerEventHandler(t.one(".info").on("click",this.infoClicked,this)))),this.get("photo-engagement")&&this.registerEventHandler(this.get("photo-engagement").on("valuesChanged",function(e){e.commentCount&&t.one(".comment span.button-comment-count").set("text",e.commentCount.newVal)})),this.attachKeyEvent("down:67",this.commentClicked.bind(this)),this.appContext.experiments.fullscreen.getMode()&&this.attachKeyEvent("down:71,65,69,84",this.menuItemsOpened.bind(this)),this}})},"@VERSION@",{requires:["flickr-view","hermes-template-photo-sidebar-actions","fluid-modal-view","signin-helper","fluid-share-photo-view"],optional:["fave-view","photo-engagement-models"],langBundles:["photo-sidebar-actions-view","photo-page-scrappy","common"]});
YUI.add("hermes-lang-photo-sidebar-actions-view",function(e,t){e.Intl.add("hermes/photo-sidebar-actions-view","en-US",{OOPS:["Oops!"],SIGN_IN_TO_COMMENT:["So you want to comment? Sign in and try again."],SIGN_IN:["Sign in"],CANCEL:["Forget it"]})},"@VERSION@",{requires:["intl"]});
